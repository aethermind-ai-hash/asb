<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Smart FAQ Assistant</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="container">

        <!-- BRAND LOGO -->
        <div class="brand-logo">
            <img src="{{ url_for('static', path='logo.png') }}" alt="Logo" class="brand-logo-img">
            <span>Smart FAQ Assistant</span>
        </div>

        <!-- Chat messages -->
        <div class="chat-box" id="chat-box"></div>

        <!-- Popular Questions -->
        <div class="popular-questions">
            <h2>Popular Questions</h2>
            <ul id="faq-questions">
                <!-- Popular FAQs will be loaded dynamically -->
            </ul>

        </div>

        <!-- Ask box -->
        <div class="ask-box">
            <input type="text" id="question-input" placeholder="Type your question..." />
            <button id="ask-btn">Ask</button>
        </div>
    </div>

    <!-- SCRIPT -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const faq = {{ faq | tojson | safe }};
            const chatBox = document.getElementById("chat-box");

            // Typing effect for bot
            async function typeMessage(text) {
                const div = document.createElement("div");
                div.className = "chat-msg bot-msg";
                chatBox.appendChild(div);

                for (let i = 0; i < text.length; i++) {
                    div.textContent += text[i];
                    chatBox.scrollTop = chatBox.scrollHeight;
                    await new Promise(resolve => setTimeout(resolve, 30));
                }
            }

            function addMessage(text, isUser = false) {
                if (isUser) {
                    const div = document.createElement("div");
                    div.className = "chat-msg user-msg";
                    div.textContent = text;
                    chatBox.appendChild(div);
                    chatBox.scrollTop = chatBox.scrollHeight;
                } else {
                    typeMessage(text);
                }
            }

            // Show welcome message
            addMessage("Hello! I'm AetherMind Smart FAQ Assistant ðŸ¤–. Ask me anything from the popular questions below or type your own question!");

            window.askQuestion = function (q) {
                const input = document.getElementById("question-input");
                input.value = q;
                sendQuestion();
            }

            function sendQuestion() {
                const input = document.getElementById("question-input");
                const question = input.value.trim();
                if (!question) return;
                addMessage(question, true);

                let answer = "Sorry, I don't know the answer.";
                let maxScore = 0;
                for (const q in faq) {
                    const score = question.toLowerCase() === q.toLowerCase() ? 1 : 0;
                    if (score > maxScore) {
                        maxScore = score;
                        answer = faq[q].answer;
                    }
                }

                addMessage(answer); // bot types gradually
                input.value = "";
            }

            const askBtn = document.getElementById("ask-btn");
            const questionInput = document.getElementById("question-input");

            if (askBtn) askBtn.addEventListener("click", sendQuestion);
            if (questionInput) questionInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter") sendQuestion();
            });
        });
    </script>
</body>

</html>
